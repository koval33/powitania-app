<%- include('partials/head') %>

<!-- HERO -->
<section class="py-12 md:py-16 border-b border-white/5">
  <div class="max-w-6xl mx-auto px-4 text-center">
    <h1 class="text-3xl md:text-4xl font-bold text-white mb-3" style="font-family: 'Poppins', sans-serif;">Bank głosów</h1>
    <p class="text-lg text-gray-400 max-w-2xl mx-auto">Ponad 230 profesjonalnych lektorów w 30+ językach. Odsłuchaj próbki i znajdź idealny głos.</p>
  </div>
</section>

<!-- FILTRY -->
<section class="py-6 bg-dark-800 sticky top-[73px] z-40 border-b border-white/5">
  <div class="max-w-6xl mx-auto px-4">
    <div class="flex flex-wrap items-center gap-3">
      <!-- Płeć -->
      <div class="flex rounded-lg overflow-hidden border border-white/10">
        <button data-filter="gender" data-value="all" class="filter-btn active px-4 py-2 text-sm font-medium">Wszyscy</button>
        <button data-filter="gender" data-value="m" class="filter-btn px-4 py-2 text-sm font-medium">Mężczyźni</button>
        <button data-filter="gender" data-value="f" class="filter-btn px-4 py-2 text-sm font-medium">Kobiety</button>
      </div>

      <!-- Język -->
      <select id="filter-lang" class="bg-dark-700 border border-white/10 text-gray-300 text-sm rounded-lg px-4 py-2 focus:border-accent focus:outline-none">
        <option value="all">Wszystkie języki</option>
        <option value="polski">Polski</option>
        <option value="angielski">Angielski</option>
        <option value="niemiecki">Niemiecki</option>
        <option value="francuski">Francuski</option>
      </select>

      <!-- Wiek -->
      <select id="filter-age" class="bg-dark-700 border border-white/10 text-gray-300 text-sm rounded-lg px-4 py-2 focus:border-accent focus:outline-none">
        <option value="all">Każdy wiek</option>
        <option value="20-30">20-30 lat</option>
        <option value="30-50">30-50 lat</option>
        <option value="50+">50+ lat</option>
      </select>

      <!-- Specjalne -->
      <label class="flex items-center gap-2 text-sm text-gray-400 cursor-pointer hover:text-white transition-colors">
        <input type="checkbox" id="filter-famous" class="w-4 h-4 rounded bg-dark-700 border-white/10 text-accent focus:ring-accent">
        Znani i lubiani
      </label>
      <label class="flex items-center gap-2 text-sm text-gray-400 cursor-pointer hover:text-white transition-colors">
        <input type="checkbox" id="filter-native" class="w-4 h-4 rounded bg-dark-700 border-white/10 text-accent focus:ring-accent">
        Tylko natives
      </label>

      <!-- Szukaj -->
      <div class="ml-auto">
        <input type="text" id="filter-search" placeholder="Szukaj lektora..." class="bg-dark-700 border border-white/10 text-gray-300 text-sm rounded-lg px-4 py-2 w-48 focus:border-accent focus:outline-none placeholder-gray-500">
      </div>
    </div>
  </div>
</section>

<!-- LICZNIK -->
<div class="max-w-6xl mx-auto px-4 py-4">
  <p class="text-sm text-gray-500">Znaleziono: <span id="voice-count" class="text-white font-semibold"><%= voices.length %></span> lektorów</p>
</div>

<!-- SIATKA LEKTORÓW -->
<section class="pb-16">
  <div class="max-w-6xl mx-auto px-4">
    <div id="voices-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-5">
      <% voices.forEach(function(v) { %>
      <div class="voice-card bg-dark-800 rounded-xl border border-white/5 p-5 hover:border-accent/30 transition-all"
           data-gender="<%= v.gender %>"
           data-age="<%= v.age %>"
           data-languages="<%= v.languages.join(',') %>"
           data-famous="<%= v.famous %>"
           data-native="<%= v.native %>"
           data-name="<%= v.name.toLowerCase() %>">

        <div class="flex items-start justify-between mb-3">
          <div>
            <h3 class="text-lg font-bold text-white"><%= v.name %></h3>
            <div class="flex items-center gap-2 mt-1">
              <span class="text-xs text-gray-500"><%= v.age %> lat</span>
              <span class="text-xs text-gray-600">&bull;</span>
              <% v.languages.forEach(function(lang, i) { %>
                <span class="text-xs bg-dark-600 text-gray-300 px-2 py-0.5 rounded"><%= lang %></span>
              <% }); %>
            </div>
          </div>
          <% if (v.famous) { %>
            <span class="text-xs bg-yellow-500/10 text-yellow-400 px-2 py-1 rounded font-medium">Znany głos</span>
          <% } else if (v.native) { %>
            <span class="text-xs bg-blue-500/10 text-blue-400 px-2 py-1 rounded font-medium">Native</span>
          <% } %>
        </div>

        <!-- Audio player -->
        <div class="flex items-center gap-3 bg-dark-900/50 rounded-lg p-3 mb-3">
          <button class="play-btn w-10 h-10 flex-shrink-0 bg-accent hover:bg-accent-light rounded-full flex items-center justify-center transition-colors" data-audio="<%= v.audio %>">
            <svg class="play-icon w-5 h-5 text-white ml-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            <svg class="pause-icon w-5 h-5 text-white hidden" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
          </button>
          <div class="flex-1">
            <div class="audio-progress w-full h-1.5 bg-dark-600 rounded-full overflow-hidden cursor-pointer">
              <div class="audio-bar h-full bg-accent rounded-full transition-all" style="width: 0%"></div>
            </div>
            <div class="flex justify-between mt-1">
              <span class="audio-time text-[10px] text-gray-500">0:00</span>
              <span class="audio-duration text-[10px] text-gray-500">--:--</span>
            </div>
          </div>
        </div>

        <!-- Info + CTA -->
        <div class="flex items-center justify-between">
          <div class="text-sm">
            <% if (v.price) { %>
              <span class="text-white font-semibold">od <%= v.price %> PLN</span>
              <% if (v.turnaround) { %>
                <span class="text-gray-500 ml-2"><%= v.turnaround %></span>
              <% } %>
            <% } else { %>
              <span class="text-gray-500">Zapytaj o cenę</span>
            <% } %>
          </div>
          <a href="<%= v.profileUrl %>" class="text-accent hover:text-accent-light text-sm font-medium transition-colors">
            Więcej &rarr;
          </a>
        </div>
      </div>
      <% }); %>
    </div>

    <!-- Pusty stan -->
    <div id="no-results" class="hidden text-center py-16">
      <svg class="w-16 h-16 text-gray-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"/></svg>
      <p class="text-gray-500 text-lg">Nie znaleziono lektorów spełniających kryteria</p>
      <button onclick="resetFilters()" class="mt-4 text-accent hover:text-accent-light text-sm font-medium">Wyczyść filtry</button>
    </div>
  </div>
</section>

<!-- CTA -->
<section class="py-12 bg-dark-800 border-t border-white/5">
  <div class="max-w-3xl mx-auto px-4 text-center">
    <h2 class="text-2xl font-bold text-white mb-3">Nie możesz się zdecydować?</h2>
    <p class="text-gray-400 mb-6">Opisz swój projekt, a pomożemy dobrać idealny głos.</p>
    <a href="/kontakt/" class="inline-block bg-accent hover:bg-accent-light text-white px-8 py-3 rounded-lg font-semibold transition-colors">Zapytaj o lektora</a>
  </div>
</section>

<script>
(function() {
  var currentAudio = null;
  var currentBtn = null;

  // Audio player
  document.querySelectorAll('.play-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      var src = this.dataset.audio;
      var card = this.closest('.voice-card');
      var playIcon = this.querySelector('.play-icon');
      var pauseIcon = this.querySelector('.pause-icon');
      var bar = card.querySelector('.audio-bar');
      var timeEl = card.querySelector('.audio-time');
      var durEl = card.querySelector('.audio-duration');

      // Stop previous
      if (currentAudio && currentBtn !== this) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
        currentBtn.querySelector('.play-icon').classList.remove('hidden');
        currentBtn.querySelector('.pause-icon').classList.add('hidden');
        currentBtn.closest('.voice-card').querySelector('.audio-bar').style.width = '0%';
      }

      if (currentAudio && currentBtn === this && !currentAudio.paused) {
        currentAudio.pause();
        playIcon.classList.remove('hidden');
        pauseIcon.classList.add('hidden');
        return;
      }

      if (!currentAudio || currentBtn !== this) {
        currentAudio = new Audio(src);
        currentBtn = this;

        currentAudio.addEventListener('loadedmetadata', function() {
          durEl.textContent = formatTime(currentAudio.duration);
        });

        currentAudio.addEventListener('timeupdate', function() {
          var pct = (currentAudio.currentTime / currentAudio.duration) * 100;
          bar.style.width = pct + '%';
          timeEl.textContent = formatTime(currentAudio.currentTime);
        });

        currentAudio.addEventListener('ended', function() {
          playIcon.classList.remove('hidden');
          pauseIcon.classList.add('hidden');
          bar.style.width = '0%';
          timeEl.textContent = '0:00';
        });

        // Click on progress bar
        card.querySelector('.audio-progress').addEventListener('click', function(e) {
          if (currentAudio && currentBtn === btn) {
            var rect = this.getBoundingClientRect();
            var pct = (e.clientX - rect.left) / rect.width;
            currentAudio.currentTime = pct * currentAudio.duration;
          }
        });
      }

      currentAudio.play();
      playIcon.classList.add('hidden');
      pauseIcon.classList.remove('hidden');
    });
  });

  function formatTime(s) {
    var m = Math.floor(s / 60);
    var sec = Math.floor(s % 60);
    return m + ':' + (sec < 10 ? '0' : '') + sec;
  }

  // Filters
  var activeGender = 'all';

  document.querySelectorAll('.filter-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      this.parentElement.querySelectorAll('.filter-btn').forEach(function(b) { b.classList.remove('active'); });
      this.classList.add('active');
      activeGender = this.dataset.value;
      applyFilters();
    });
  });

  document.getElementById('filter-lang').addEventListener('change', applyFilters);
  document.getElementById('filter-age').addEventListener('change', applyFilters);
  document.getElementById('filter-famous').addEventListener('change', applyFilters);
  document.getElementById('filter-native').addEventListener('change', applyFilters);
  document.getElementById('filter-search').addEventListener('input', applyFilters);

  function applyFilters() {
    var lang = document.getElementById('filter-lang').value;
    var age = document.getElementById('filter-age').value;
    var famous = document.getElementById('filter-famous').checked;
    var native = document.getElementById('filter-native').checked;
    var search = document.getElementById('filter-search').value.toLowerCase();
    var count = 0;

    document.querySelectorAll('.voice-card').forEach(function(card) {
      var show = true;

      if (activeGender !== 'all' && card.dataset.gender !== activeGender) show = false;
      if (lang !== 'all' && card.dataset.languages.indexOf(lang) === -1) show = false;
      if (age !== 'all' && card.dataset.age !== age) show = false;
      if (famous && card.dataset.famous !== 'true') show = false;
      if (native && card.dataset.native !== 'true') show = false;
      if (search && card.dataset.name.indexOf(search) === -1) show = false;

      card.style.display = show ? '' : 'none';
      if (show) count++;
    });

    document.getElementById('voice-count').textContent = count;
    document.getElementById('no-results').classList.toggle('hidden', count > 0);
  }

  window.resetFilters = function() {
    activeGender = 'all';
    document.querySelectorAll('.filter-btn').forEach(function(b) { b.classList.remove('active'); });
    document.querySelector('.filter-btn[data-value="all"]').classList.add('active');
    document.getElementById('filter-lang').value = 'all';
    document.getElementById('filter-age').value = 'all';
    document.getElementById('filter-famous').checked = false;
    document.getElementById('filter-native').checked = false;
    document.getElementById('filter-search').value = '';
    applyFilters();
  };
})();
</script>

<style>
.filter-btn { color: #9ca3af; background: transparent; transition: all 0.2s; }
.filter-btn:hover { color: #fff; }
.filter-btn.active { color: #fff; background: #10b981; }
</style>

<%- include('partials/foot') %>

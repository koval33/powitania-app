<%- include('partials/head') %>

<section class="py-10 md:py-16">
  <div class="max-w-5xl mx-auto px-4">

    <!-- Breadcrumb -->
    <nav class="text-sm mb-8">
      <a href="/" class="text-gray-500 hover:text-white transition-colors">Strona główna</a>
      <span class="text-gray-600 mx-2">/</span>
      <a href="/bank-glosow/" class="text-gray-500 hover:text-white transition-colors">Bank głosów</a>
      <span class="text-gray-600 mx-2">/</span>
      <span class="text-gray-300"><%= lektor.name %></span>
    </nav>

    <!-- Profil: zdjęcie + info -->
    <div class="flex flex-col md:flex-row gap-8 md:gap-12">

      <!-- Lewa kolumna: zdjęcie + tagi -->
      <div class="flex-shrink-0">
        <div class="w-48 h-48 md:w-56 md:h-56 rounded-2xl overflow-hidden border-2 border-white/10 mx-auto md:mx-0">
          <img src="<%= lektor.photo %>" alt="<%= lektor.name %>" class="w-full h-full object-cover">
        </div>
        <div class="flex flex-wrap gap-2 mt-4 justify-center md:justify-start">
          <% if (lektor.famous) { %>
            <span class="bg-yellow-500/10 text-yellow-400 text-xs font-semibold px-3 py-1 rounded-full border border-yellow-500/20">Znani i lubiani</span>
          <% } %>
          <% if (lektor.native) { %>
            <span class="bg-blue-500/10 text-blue-400 text-xs font-semibold px-3 py-1 rounded-full border border-blue-500/20">Native speaker</span>
          <% } %>
          <span class="bg-dark-700 text-gray-400 text-xs font-medium px-3 py-1 rounded-full border border-white/10">
            <%= lektor.gender === 'm' ? 'Mężczyzna' : 'Kobieta' %>
          </span>
          <span class="bg-dark-700 text-gray-400 text-xs font-medium px-3 py-1 rounded-full border border-white/10">
            <%= lektor.age %>
          </span>
        </div>
      </div>

      <!-- Prawa kolumna: dane -->
      <div class="flex-1 min-w-0">
        <h1 class="text-3xl md:text-4xl font-bold text-white mb-3"><%= lektor.name %></h1>

        <% if (lektor.description) { %>
          <p class="text-gray-400 leading-relaxed mb-6"><%= lektor.description %></p>
        <% } %>

        <!-- Meta info -->
        <div class="grid grid-cols-2 gap-4 mb-6">
          <div class="bg-dark-800 rounded-xl p-4 border border-white/5">
            <div class="text-xs text-gray-500 mb-1">Języki</div>
            <div class="text-sm text-white font-medium"><%= lektor.languages.join(', ') %></div>
          </div>
          <div class="bg-dark-800 rounded-xl p-4 border border-white/5">
            <div class="text-xs text-gray-500 mb-1">Czas realizacji</div>
            <div class="text-sm text-white font-medium"><%= lektor.turnaround || '24-48h' %></div>
          </div>
          <% if (lektor.applications && lektor.applications.length > 0) { %>
          <div class="bg-dark-800 rounded-xl p-4 border border-white/5 col-span-2">
            <div class="text-xs text-gray-500 mb-1">Zastosowanie</div>
            <div class="flex flex-wrap gap-1.5 mt-1">
              <% lektor.applications.forEach(function(app) { %>
                <span class="text-xs bg-accent/10 text-accent px-2.5 py-0.5 rounded-full"><%= app %></span>
              <% }); %>
            </div>
          </div>
          <% } %>
        </div>

        <!-- Główna próbka audio -->
        <% if (lektor.audio) { %>
        <div class="bg-dark-800 rounded-xl p-5 border border-white/5 mb-6">
          <div class="text-xs text-gray-500 mb-3 uppercase tracking-wider font-semibold">Próbka głosowa</div>
          <audio controls class="w-full audio-player" preload="none" style="height: 40px;">
            <source src="<%= lektor.audio %>" type="audio/mpeg">
          </audio>
        </div>
        <% } %>

        <!-- CTA -->
        <div class="flex flex-col sm:flex-row gap-3">
          <a href="/#kreator" class="bg-accent hover:bg-accent-light text-white px-6 py-3 rounded-lg font-semibold text-center transition-colors">
            Zamów nagranie
          </a>
          <a href="/kontakt/" class="border border-white/20 hover:border-white text-white px-6 py-3 rounded-lg font-semibold text-center transition-colors">
            Zapytaj o wycenę
          </a>
        </div>
      </div>
    </div>

    <!-- PRÓBKI AUDIO i VIDEO -->
    <%
      var audioSamples = (lektor.samples || []).filter(function(s) {
        return s.url && !s.url.includes('youtu') && !s.url.includes('vimeo');
      });
      var videoSamples = (lektor.samples || []).filter(function(s) {
        return s.url && (s.url.includes('youtu') || s.url.includes('vimeo'));
      });
    %>

    <% if (audioSamples.length > 0 || videoSamples.length > 0) { %>
    <div class="mt-12">
      <h2 class="text-2xl font-bold text-white mb-6">Wszystkie próbki</h2>

      <% if (audioSamples.length > 0) { %>
      <div class="space-y-3 mb-8">
        <% audioSamples.forEach(function(sample, idx) { %>
        <div class="bg-dark-800 rounded-xl border border-white/5 overflow-hidden">
          <div class="flex items-center gap-4 p-4">
            <button onclick="toggleSample(this, '<%= sample.url %>')" class="w-10 h-10 bg-accent/10 hover:bg-accent/20 rounded-full flex items-center justify-center flex-shrink-0 transition-colors sample-btn">
              <svg class="w-4 h-4 text-accent play-ico" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
              <svg class="w-4 h-4 text-accent pause-ico hidden" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            </button>
            <div class="flex-1 min-w-0">
              <div class="text-sm text-white font-medium truncate"><%= sample.name || ('Próbka ' + (idx + 1)) %></div>
            </div>
            <div class="sample-time text-xs text-gray-600 tabular-nums"></div>
          </div>
          <!-- Waveform bar -->
          <div class="px-4 pb-3 hidden sample-player-wrap">
            <audio controls class="w-full" preload="none" style="height: 36px;">
              <source src="<%= sample.url %>" type="audio/mpeg">
            </audio>
          </div>
        </div>
        <% }); %>
      </div>
      <% } %>

      <% if (videoSamples.length > 0) { %>
      <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
        <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z"/><path fill="#fff" d="M9.545 15.568V8.432L15.818 12z"/></svg>
        Realizacje wideo
      </h3>
      <div class="grid sm:grid-cols-2 gap-4">
        <% videoSamples.forEach(function(video) {
          // Extract YouTube video ID
          var ytId = '';
          var url = video.url || '';
          if (url.includes('youtu.be/')) {
            ytId = url.split('youtu.be/')[1].split(/[?&#]/)[0];
          } else if (url.includes('youtube.com/watch')) {
            var match = url.match(/[?&]v=([^&#]+)/);
            if (match) ytId = match[1];
          } else if (url.includes('youtube.com/shorts/')) {
            ytId = url.split('shorts/')[1].split(/[?&#]/)[0];
          }
        %>
        <div class="bg-dark-800 rounded-xl border border-white/5 overflow-hidden group">
          <% if (ytId) { %>
          <div class="aspect-video relative cursor-pointer" onclick="loadYT(this, '<%= ytId %>')">
            <img src="https://img.youtube.com/vi/<%= ytId %>/mqdefault.jpg" alt="<%= video.name %>" class="w-full h-full object-cover" loading="lazy">
            <div class="absolute inset-0 bg-black/40 group-hover:bg-black/20 transition-colors flex items-center justify-center">
              <div class="w-14 h-14 bg-red-600 rounded-full flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                <svg class="w-6 h-6 text-white ml-1" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
              </div>
            </div>
          </div>
          <% } else { %>
          <div class="aspect-video bg-dark-700 flex items-center justify-center">
            <a href="<%= video.url %>" target="_blank" rel="noopener" class="text-accent hover:text-accent-light">
              <svg class="w-12 h-12" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"/></svg>
            </a>
          </div>
          <% } %>
          <div class="p-3">
            <div class="text-sm text-white font-medium"><%= video.name %></div>
          </div>
        </div>
        <% }); %>
      </div>
      <% } %>
    </div>
    <% } %>

    <!-- CENNIK (jeśli nie ukryty) -->
    <% if (!lektor.hidePrice && lektor.prices) { %>
    <div class="mt-12">
      <h2 class="text-2xl font-bold text-white mb-6">Cennik</h2>

      <div class="grid md:grid-cols-3 gap-6">

        <!-- Powitanie / IVR -->
        <% if (lektor.prices.ivr_100) { %>
        <div class="bg-dark-800 rounded-xl border border-white/5 p-6">
          <div class="flex items-center gap-2 mb-4">
            <div class="w-8 h-8 bg-emerald-500/10 rounded-lg flex items-center justify-center">
              <svg class="w-4 h-4 text-emerald-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"/></svg>
            </div>
            <h3 class="text-white font-bold">Powitanie / IVR</h3>
          </div>
          <table class="w-full text-sm">
            <tbody class="divide-y divide-white/5">
              <tr>
                <td class="py-2 text-gray-400">do 100 słów</td>
                <td class="py-2 text-right text-white font-semibold"><%= lektor.prices.ivr_100 %> zł</td>
              </tr>
              <% if (lektor.prices.ivr_200) { %>
              <tr>
                <td class="py-2 text-gray-400">101-200 słów</td>
                <td class="py-2 text-right text-white font-semibold"><%= lektor.prices.ivr_200 %> zł</td>
              </tr>
              <% } %>
              <% if (lektor.prices.ivr_200plus && lektor.prices.ivr_200plus !== 'wycena') { %>
              <tr>
                <td class="py-2 text-gray-400">pow. 200 słów</td>
                <td class="py-2 text-right text-white font-semibold"><%= lektor.prices.ivr_200plus %> zł</td>
              </tr>
              <% } else { %>
              <tr>
                <td class="py-2 text-gray-400">pow. 200 słów</td>
                <td class="py-2 text-right text-accent text-xs font-medium">wycena indyw.</td>
              </tr>
              <% } %>
              <% if (lektor.prices.ivr_guarantee_100) { %>
              <tr>
                <td class="py-2 text-gray-500 text-xs">Gwarancja modyfikacji do 100 słów</td>
                <td class="py-2 text-right text-gray-300 text-xs"><%= lektor.prices.ivr_guarantee_100 %> zł</td>
              </tr>
              <% } %>
              <% if (lektor.prices.ivr_guarantee_100plus) { %>
              <tr>
                <td class="py-2 text-gray-500 text-xs">Gwarancja modyfikacji pow. 100 słów</td>
                <td class="py-2 text-right text-gray-300 text-xs"><%= lektor.prices.ivr_guarantee_100plus %> zł</td>
              </tr>
              <% } %>
              <% if (lektor.prices.ivr_melody) { %>
              <tr>
                <td class="py-2 text-gray-500 text-xs">Melodia w tle</td>
                <td class="py-2 text-right text-gray-300 text-xs"><%= lektor.prices.ivr_melody %> zł</td>
              </tr>
              <% } %>
              <% if (lektor.prices.ivr_bilingual) { %>
              <tr>
                <td class="py-2 text-gray-500 text-xs">Pakiet dwujęzyczny</td>
                <td class="py-2 text-right text-gray-300 text-xs"><%= lektor.prices.ivr_bilingual %> zł</td>
              </tr>
              <% } %>
            </tbody>
          </table>
        </div>
        <% } %>

        <!-- Spot reklamowy -->
        <% if (lektor.prices.spot_radio_local) { %>
        <div class="bg-dark-800 rounded-xl border border-white/5 p-6">
          <div class="flex items-center gap-2 mb-4">
            <div class="w-8 h-8 bg-red-500/10 rounded-lg flex items-center justify-center">
              <svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z"/></svg>
            </div>
            <h3 class="text-white font-bold">Spot reklamowy</h3>
          </div>
          <table class="w-full text-sm">
            <tbody class="divide-y divide-white/5">
              <tr>
                <td class="py-2 text-gray-400">Radio — lokalny</td>
                <td class="py-2 text-right text-white font-semibold"><%= lektor.prices.spot_radio_local %> zł</td>
              </tr>
              <% if (lektor.prices.spot_radio_national) { %>
              <tr>
                <td class="py-2 text-gray-400">Radio — ogólnokrajowy</td>
                <td class="py-2 text-right text-white font-semibold"><%= lektor.prices.spot_radio_national %> zł</td>
              </tr>
              <% } %>
              <% if (lektor.prices.spot_tv_local) { %>
              <tr>
                <td class="py-2 text-gray-400">TV — lokalny</td>
                <td class="py-2 text-right text-white font-semibold"><%= lektor.prices.spot_tv_local %> zł</td>
              </tr>
              <% } %>
              <% if (lektor.prices.spot_tv_national) { %>
              <tr>
                <td class="py-2 text-gray-400">TV — ogólnokrajowy</td>
                <td class="py-2 text-right text-white font-semibold"><%= lektor.prices.spot_tv_national %> zł</td>
              </tr>
              <% } %>
              <% if (lektor.prices.spot_social_1min) { %>
              <tr>
                <td class="py-2 text-gray-400">Social media — do 1 min</td>
                <td class="py-2 text-right text-white font-semibold"><%= lektor.prices.spot_social_1min %> zł</td>
              </tr>
              <% } %>
              <% if (lektor.prices.spot_social_2min) { %>
              <tr>
                <td class="py-2 text-gray-400">Social media — do 2 min</td>
                <td class="py-2 text-right text-white font-semibold"><%= lektor.prices.spot_social_2min %> zł</td>
              </tr>
              <% } %>
            </tbody>
          </table>
          <p class="text-xs text-gray-600 mt-3">Stawka uwzględnia licencję na okres do 12 mies.</p>
        </div>
        <% } %>

        <!-- Narracja do filmu -->
        <% if (lektor.prices.narration_1page) { %>
        <div class="bg-dark-800 rounded-xl border border-white/5 p-6">
          <div class="flex items-center gap-2 mb-4">
            <div class="w-8 h-8 bg-blue-500/10 rounded-lg flex items-center justify-center">
              <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"/></svg>
            </div>
            <h3 class="text-white font-bold">Narracja do filmu</h3>
          </div>
          <table class="w-full text-sm">
            <tbody class="divide-y divide-white/5">
              <tr>
                <td class="py-2 text-gray-400">1 strona A4</td>
                <td class="py-2 text-right text-white font-semibold"><%= lektor.prices.narration_1page %> zł</td>
              </tr>
              <% if (lektor.prices.narration_2pages) { %>
              <tr>
                <td class="py-2 text-gray-400">2 strony A4</td>
                <td class="py-2 text-right text-white font-semibold"><%= lektor.prices.narration_2pages %> zł</td>
              </tr>
              <% } %>
              <% if (lektor.prices.narration_3pages) { %>
              <tr>
                <td class="py-2 text-gray-400">3 strony A4</td>
                <td class="py-2 text-right text-white font-semibold"><%= lektor.prices.narration_3pages %> zł</td>
              </tr>
              <% } %>
              <tr>
                <td class="py-2 text-gray-400">pow. 3 stron A4</td>
                <td class="py-2 text-right text-accent text-xs font-medium">wycena indyw.</td>
              </tr>
            </tbody>
          </table>
        </div>
        <% } %>

      </div>
    </div>
    <% } %>

    <!-- Inni lektorzy -->
    <% if (similar && similar.length > 0) { %>
    <div class="mt-16">
      <h2 class="text-2xl font-bold text-white mb-6">Podobni lektorzy</h2>
      <div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 gap-5">
        <% similar.forEach(function(s) { %>
        <a href="/lektor/<%= s.id %>/" class="text-center group">
          <img src="<%= s.photo %>" alt="<%= s.name %>" class="w-20 h-20 rounded-full mx-auto object-cover border-2 border-white/10 group-hover:border-accent/50 transition-all mb-2" loading="lazy">
          <div class="text-white text-sm font-medium group-hover:text-accent transition-colors truncate"><%= s.name %></div>
          <div class="text-xs text-gray-600"><%= s.gender === 'm' ? 'Lektor' : 'Lektorka' %></div>
        </a>
        <% }); %>
      </div>
    </div>
    <% } %>

  </div>
</section>

<script>
// Audio sample player
var currentAudio = null;
var currentBtn = null;

function toggleSample(btn, url) {
  var wrap = btn.closest('.bg-dark-800').querySelector('.sample-player-wrap');

  // Toggle expand
  if (wrap) wrap.classList.toggle('hidden');

  // If different button or no audio
  if (currentBtn && currentBtn !== btn) {
    currentBtn.querySelector('.play-ico').classList.remove('hidden');
    currentBtn.querySelector('.pause-ico').classList.add('hidden');
  }

  if (currentAudio && !currentAudio.paused && currentBtn === btn) {
    currentAudio.pause();
    btn.querySelector('.play-ico').classList.remove('hidden');
    btn.querySelector('.pause-ico').classList.add('hidden');
    return;
  }

  if (!currentAudio) currentAudio = new Audio();
  currentAudio.src = url;
  currentAudio.play();
  currentBtn = btn;
  btn.querySelector('.play-ico').classList.add('hidden');
  btn.querySelector('.pause-ico').classList.remove('hidden');

  currentAudio.onended = function() {
    btn.querySelector('.play-ico').classList.remove('hidden');
    btn.querySelector('.pause-ico').classList.add('hidden');
  };
}

// Lazy YouTube embed
function loadYT(el, ytId) {
  el.innerHTML = '<iframe class="w-full h-full absolute inset-0" src="https://www.youtube.com/embed/' + ytId + '?autoplay=1&rel=0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
}
</script>

<%- include('partials/foot') %>
